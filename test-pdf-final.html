<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PDF Final</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="js/admin-dashboard.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Test PDF Final</h1>
        <p>Este archivo prueba la generación de PDF con códigos QR y información de productos.</p>
        
        <button class="btn btn-primary" onclick="testGenerarPDF()">
            <i class="fas fa-file-pdf"></i> Generar PDF de Prueba
        </button>
        
        <div id="resultado" class="mt-3"></div>
    </div>

    <script>
        let adminDashboard = null;

        // Datos de prueba
        const productosPrueba = [
            {
                id: '1',
                codigo: 'PROD001',
                nombre: 'Aceite de Motor 4T',
                descripcion: 'Aceite sintético para motos 4 tiempos, 1L. Ideal para motocicletas de alto rendimiento.',
                precio: 12.50,
                stock: 45,
                stockMinimo: 10,
                stockMaximo: 100,
                proveedor: 'MotoParts Ecuador S.A.'
            },
            {
                id: '2',
                codigo: 'PROD002',
                nombre: 'Filtro de Aceite Honda',
                descripcion: 'Filtro de aceite compatible con motos Honda. Alta calidad y durabilidad garantizada.',
                precio: 8.75,
                stock: 32,
                stockMinimo: 15,
                stockMaximo: 80,
                proveedor: 'Repuestos Honda Guayaquil'
            },
            {
                id: '3',
                codigo: 'PROD003',
                nombre: 'Batería 12V 7Ah',
                descripcion: 'Batería de gel para motos, 12V 7Ah. Tecnología avanzada para mayor vida útil.',
                precio: 45.00,
                stock: 3,
                stockMinimo: 5,
                stockMaximo: 50,
                proveedor: 'Yamaha Parts Center'
            },
            {
                id: '4',
                codigo: 'PROD004',
                nombre: 'Cadena de Transmisión',
                descripcion: 'Cadena de transmisión 520 para motos. Resistente y de alta calidad.',
                precio: 35.50,
                stock: 15,
                stockMinimo: 5,
                stockMaximo: 50,
                proveedor: 'Transmisiones Rápidas'
            }
        ];

        async function testGenerarPDF() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<div class="alert alert-info">Generando PDF...</div>';
            
            try {
                // Guardar productos de prueba en localStorage
                localStorage.setItem('productos', JSON.stringify(productosPrueba));
                
                // Inicializar dashboard si no está disponible
                if (!adminDashboard) {
                    console.log('Inicializando dashboard...');
                    adminDashboard = new AdminDashboard();
                }
                
                console.log('Llamando a generarPDFProductos...');
                await adminDashboard.generarPDFProductos();
                
                resultado.innerHTML = '<div class="alert alert-success">PDF generado exitosamente</div>';
                
            } catch (error) {
                console.error('Error:', error);
                resultado.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
            }
        }

        // Auto-inicializar al cargar
        window.addEventListener('load', () => {
            console.log('Página cargada, inicializando dashboard...');
            try {
                adminDashboard = new AdminDashboard();
                console.log('Dashboard inicializado correctamente');
            } catch (error) {
                console.error('Error inicializando dashboard:', error);
            }
        });
    </script>
</body>
</html>
